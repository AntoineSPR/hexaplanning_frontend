<div class="register-container">
  <p-toast></p-toast>

  <p-card header="Hexaplanning - Créer un compte" class="register-card">
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form" role="form" aria-label="Formulaire de création de compte">
      <div class="form-field">
        <label for="name" class="form-label">Nom d'utilisateur *</label>
        <input
          pInputText
          id="name"
          formControlName="name"
          placeholder="Entrez votre nom d'utilisateur"
          [class.p-invalid]="hasNameError"
          [attr.aria-describedby]="hasNameError ? 'name-error' : null"
          [attr.aria-invalid]="hasNameError"
          class="form-input" />
        @if (hasNameError) {
        <small class="p-error" id="name-error" role="alert" aria-live="polite">
          {{ nameError }}
        </small>
        }
      </div>

      <div class="form-field">
        <label for="email" class="form-label">Email *</label>
        <input
          pInputText
          id="email"
          type="email"
          formControlName="email"
          placeholder="Entrez votre adresse email"
          [class.p-invalid]="hasEmailError"
          [attr.aria-describedby]="hasEmailError ? 'email-error' : null"
          [attr.aria-invalid]="hasEmailError"
          autocomplete="email"
          class="form-input" />
        @if (hasEmailError) {
        <small class="p-error" id="email-error" role="alert" aria-live="polite">
          {{ emailError }}
        </small>
        }
      </div>

      <div class="form-field">
        <label for="password" class="form-label">Mot de passe *</label>
        <div class="form-label requirements-list" id="password-requirements">
          (Minimum : 8 caractères, 1 majuscule, 1 minuscule, 1 chiffre, 1 caractère spécial)
        </div>
        <p-password
          formControlName="password"
          [toggleMask]="true"
          placeholder="Entrez votre mot de passe"
          [class.p-invalid]="hasPasswordError"
          [attr.aria-describedby]="'password-requirements' + (hasPasswordError ? ' password-error' : '')"
          [attr.aria-invalid]="hasPasswordError"
          autocomplete="new-password"
          class="form-input"
          [feedback]="true"
          promptLabel="Entrez un mot de passe"
          weakLabel="Faible"
          mediumLabel="Moyen"
          strongLabel="Fort">
        </p-password>
        @if (hasPasswordError) {
        <small class="p-error" id="password-error" role="alert" aria-live="polite">
          {{ passwordError }}
        </small>
        }
      </div>

      <div class="form-field">
        <label for="confirmPassword" class="form-label">Confirmer le mot de passe *</label>
        <p-password
          formControlName="confirmPassword"
          [toggleMask]="true"
          [feedback]="false"
          placeholder="Confirmez votre mot de passe"
          [class.p-invalid]="hasConfirmPasswordError"
          [attr.aria-describedby]="hasConfirmPasswordError ? 'confirmPassword-error' : null"
          [attr.aria-invalid]="hasConfirmPasswordError"
          autocomplete="new-password"
          class="form-input"></p-password>
        @if (hasConfirmPasswordError) {
        <small class="p-error" id="confirmPassword-error" role="alert" aria-live="polite">
          {{ confirmPasswordError }}
        </small>
        }
      </div>

      <fieldset class="checkbox-fieldset">
        <legend class="visually-hidden">Acceptation des conditions</legend>

        <div class="form-field">
          <div class="checkbox-container">
            <p-checkbox
              formControlName="acceptCgu"
              [binary]="true"
              inputId="acceptCgu"
              [class.p-invalid]="hasAcceptCguError"
              [attr.aria-describedby]="hasAcceptCguError ? 'acceptCgu-error' : null"
              [attr.aria-invalid]="hasAcceptCguError">
            </p-checkbox>
            <label for="acceptCgu" class="checkbox-label">
              J'accepte les
              <a routerLink="/cgu" target="_blank" class="terms-link" aria-label="Conditions Générales d'Utilisation (ouvre dans un nouvel onglet)"
                >Conditions Générales d'Utilisation</a
              >.
            </label>
          </div>
          @if (hasAcceptCguError) {
          <small class="p-error" id="acceptCgu-error" role="alert" aria-live="polite">
            {{ acceptCguError }}
          </small>
          }
        </div>

        <div class="form-field">
          <div class="checkbox-container">
            <p-checkbox
              formControlName="acceptRgpd"
              [binary]="true"
              inputId="acceptRgpd"
              [class.p-invalid]="hasAcceptRgpdError"
              [attr.aria-describedby]="hasAcceptRgpdError ? 'acceptRgpd-error' : null"
              [attr.aria-invalid]="hasAcceptRgpdError">
            </p-checkbox>
            <label for="acceptRgpd" class="checkbox-label">
              J'accepte le traitement de mes données personnelles conformément à la
              <a routerLink="/rgpd" target="_blank" class="terms-link" aria-label="Politique de Confidentialité (ouvre dans un nouvel onglet)"
                >Politique de Confidentialité</a
              >.
            </label>
          </div>
          @if (hasAcceptRgpdError) {
          <small class="p-error" id="acceptRgpd-error" role="alert" aria-live="polite">
            {{ acceptRgpdError }}
          </small>
          }
        </div>
      </fieldset>

      <div class="form-actions">
        <p-button
          type="submit"
          label="Créer le compte"
          [loading]="isLoading"
          loadingIcon="pi pi-spin pi-spinner"
          class="submit-button"
          [disabled]="isLoading"
          [attr.aria-label]="isLoading ? 'Création du compte en cours...' : 'Créer le compte'"></p-button>
      </div>

      <div class="form-footer">
        <p>Déjà un compte ? <a routerLink="/login" class="login-link">Se connecter</a></p>
      </div>
    </form>
  </p-card>
</div>
